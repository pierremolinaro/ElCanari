//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    CustomObjectController_PMFontDocument_selectedCharacter
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class CustomObjectController_PMFontDocument_selectedCharacter : EBObject {
 
  var mObjectObserver = EBObserver ()

  //····················································································································

  var mSelectedObject : FontCharacter? {
    didSet {
      if mSelectedObject !== oldValue {
      //--- Property advance
        oldValue?.advance_property.removeEBObserver (mObjectObserver)
        oldValue?.advance_property.removeEBObserver (self.advance_property)
        mSelectedObject?.advance_property.addEBObserver (mObjectObserver)
        mSelectedObject?.advance_property.addEBObserver (self.advance_property)
        self.advance_property.postEvent ()
      //--- Property characterIsDefined
        oldValue?.characterIsDefined_property.removeEBObserver (mObjectObserver)
        oldValue?.characterIsDefined_property.removeEBObserver (self.characterIsDefined_property)
        mSelectedObject?.characterIsDefined_property.addEBObserver (mObjectObserver)
        mSelectedObject?.characterIsDefined_property.addEBObserver (self.characterIsDefined_property)
        self.characterIsDefined_property.postEvent ()
      //--- Property gerberCode
        oldValue?.gerberCode_property.removeEBObserver (mObjectObserver)
        oldValue?.gerberCode_property.removeEBObserver (self.gerberCode_property)
        mSelectedObject?.gerberCode_property.addEBObserver (mObjectObserver)
        mSelectedObject?.gerberCode_property.addEBObserver (self.gerberCode_property)
        self.gerberCode_property.postEvent ()
      //--- Property gerberCodeInstructionCountMessage
        oldValue?.gerberCodeInstructionCountMessage_property.removeEBObserver (mObjectObserver)
        oldValue?.gerberCodeInstructionCountMessage_property.removeEBObserver (self.gerberCodeInstructionCountMessage_property)
        mSelectedObject?.gerberCodeInstructionCountMessage_property.addEBObserver (mObjectObserver)
        mSelectedObject?.gerberCodeInstructionCountMessage_property.addEBObserver (self.gerberCodeInstructionCountMessage_property)
        self.gerberCodeInstructionCountMessage_property.postEvent ()
      //--- Property segmentArrayForDrawing
        oldValue?.segmentArrayForDrawing_property.removeEBObserver (mObjectObserver)
        oldValue?.segmentArrayForDrawing_property.removeEBObserver (self.segmentArrayForDrawing_property)
        mSelectedObject?.segmentArrayForDrawing_property.addEBObserver (mObjectObserver)
        mSelectedObject?.segmentArrayForDrawing_property.addEBObserver (self.segmentArrayForDrawing_property)
        self.segmentArrayForDrawing_property.postEvent ()
      //--- Relationship segments
      }
    }
  }

  //····················································································································

  override init () {
    super.init ()
    bind_property_advance ()
    bind_property_characterIsDefined ()
    bind_property_gerberCode ()
    bind_property_gerberCodeInstructionCountMessage ()
    bind_property_segmentArrayForDrawing ()
  }
  
  //····················································································································
  //   RELATIONSHIPS
  //····················································································································

  // var segments = ToManyRelationshipProxy_FontCharacter_segments () 

  //····················································································································
  //   OBJECT OBSERVABLE PROPERTIES
  //····················································································································

  var advance_property = EBPropertyProxy_Int () 
  var characterIsDefined_property = EBTransientProperty_Bool () 
  var gerberCode_property = EBTransientProperty_CharacterGerberCodeClass () 
  var gerberCodeInstructionCountMessage_property = EBTransientProperty_String () 
  var segmentArrayForDrawing_property = EBTransientProperty_CharacterSegmentListClass () 

  //····················································································································
  //    Explorer
  //····················································································································

  private var mValueExplorer : NSButton?
  private var mExplorerWindow : NSWindow?

  //····················································································································

  final func addExplorer (name : String, y : inout CGFloat, view : NSView) {
    let font = NSFont.boldSystemFont (ofSize: sw34_smallSystemFontSize)
    let tf = NSTextField (frame:secondColumn (y))
    tf.isEnabled = true
    tf.isEditable = false
    tf.stringValue = name
    tf.font = font
    view.addSubview (tf)
    let valueExplorer = NSButton (frame:thirdColumn (y))
    valueExplorer.font = font
    valueExplorer.title = explorerIndexString (mEasyBindingsObjectIndex) + className
    valueExplorer.target = self
    valueExplorer.action = #selector(CustomObjectController_PMFontDocument_selectedCharacter.showObjectWindowFromExplorerButton(_:))
    view.addSubview (valueExplorer)
    mValueExplorer = valueExplorer
    y += EXPLORER_ROW_HEIGHT
  }
  
  //····················································································································

  func buildExplorerWindow () {
  //-------------------------------------------------- Create Window
    let r = NSRect (x:20.0, y:20.0, width:10.0, height:10.0)
    mExplorerWindow = NSWindow (contentRect: r, styleMask: [.titled, .closable], backing: .buffered, defer: true, screen: nil)
  //-------------------------------------------------- Adding properties
    let view = NSView (frame:r)
    var y : CGFloat = 0.0
    createEntryForPropertyNamed (
      "advance",
      idx:self.advance_property.mEasyBindingsObjectIndex,
      y:&y,
      view:view,
      observerExplorer:&self.advance_property.mObserverExplorer,
      valueExplorer:&self.advance_property.mValueExplorer
    )
  //-------------------------------------------------- Finish Window construction
  //--- Resize View
    let viewFrame = NSRect (x:0.0, y:0.0, width:EXPLORER_ROW_WIDTH, height:y)
    view.frame = viewFrame
  //--- Set content size
    mExplorerWindow?.setContentSize (NSSize (width:EXPLORER_ROW_WIDTH + 16.0, height:fmin (600.0, y)))
  //--- Set close button as 'remove window' button
    let closeButton : NSButton? = mExplorerWindow?.standardWindowButton (.closeButton)
    closeButton?.target = self
    closeButton?.action = #selector(CustomObjectController_PMFontDocument_selectedCharacter.deleteSelectionControllerWindowAction(_:))
  //--- Set window title
    let windowTitle = explorerIndexString (mEasyBindingsObjectIndex) + className
    mExplorerWindow!.title = windowTitle
  //--- Add Scroll view
    let frame = NSRect (x:0.0, y:0.0, width:EXPLORER_ROW_WIDTH, height:y)
    let sw = NSScrollView (frame:frame)
    sw.hasVerticalScroller = true
    sw.documentView = view
    mExplorerWindow!.contentView = sw
  }

  //····················································································································
  //   showObjectWindowFromExplorerButton
  //····················································································································

  @objc func showObjectWindowFromExplorerButton (_ : Any?) {
    if mExplorerWindow == nil {
      buildExplorerWindow ()
    }
    mExplorerWindow?.makeKeyAndOrderFront(nil)
  }
  
  //····················································································································
  //   deleteSelectionControllerWindowAction
  //····················································································································

  @objc func deleteSelectionControllerWindowAction (_ : Any) {
    clearObjectExplorer ()
  }

  //····················································································································
  //   clearObjectExplorer
  //····················································································································

  func clearObjectExplorer () {
    let closeButton = mExplorerWindow?.standardWindowButton (.closeButton)
    closeButton!.target = nil
    mExplorerWindow?.orderOut (nil)
    mExplorerWindow = nil
  }

  //···················································································································*

  private final func bind_property_advance () {
    self.advance_property.readModelFunction = { [weak self] in
      if let model = self?.mSelectedObject {
        return model.advance_property_selection
      }else{
        return .empty
      }
    }
    self.advance_property.writeModelFunction = { [weak self] (inValue : Int) in
      self?.mSelectedObject?.advance = inValue
    }
    self.advance_property.validateAndWriteModelFunction = { [weak self] (candidateValue : Int, windowForSheet : NSWindow?) in
      self?.mSelectedObject?.advance_property.validateAndSetProp (candidateValue, windowForSheet:windowForSheet) ?? false
    }
  }

  //···················································································································*

  private final func bind_property_characterIsDefined () {
    self.characterIsDefined_property.readModelFunction = { [weak self] in
      if let model = self?.mSelectedObject {
        return model.characterIsDefined_property_selection
      }else{
        return .empty
      }
    }
  }

  //···················································································································*

  private final func bind_property_gerberCode () {
    self.gerberCode_property.readModelFunction = { [weak self] in
      if let model = self?.mSelectedObject {
        return model.gerberCode_property_selection
      }else{
        return .empty
      }
    }
  }

  //···················································································································*

  private final func bind_property_gerberCodeInstructionCountMessage () {
    self.gerberCodeInstructionCountMessage_property.readModelFunction = { [weak self] in
      if let model = self?.mSelectedObject {
        return model.gerberCodeInstructionCountMessage_property_selection
      }else{
        return .empty
      }
    }
  }

  //···················································································································*

  private final func bind_property_segmentArrayForDrawing () {
    self.segmentArrayForDrawing_property.readModelFunction = { [weak self] in
      if let model = self?.mSelectedObject {
        return model.segmentArrayForDrawing_property_selection
      }else{
        return .empty
      }
    }
  }



  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

