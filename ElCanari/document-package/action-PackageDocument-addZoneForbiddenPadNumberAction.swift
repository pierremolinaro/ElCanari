//--- START OF USER ZONE 1

extension PackageDocument : NSTextFieldDelegate {

  @objc func controlTextDidChange (_ inNotification : Notification) {
    if let s = self.mAddZoneForbiddenPadNumberValueTextField?.currentEditor()?.string,
       let proposedValue = Int (s),
       proposedValue > 0 {
      let selectedPadZone = self.mPackageZoneSelectionController.selectedArray [0]
    //--- Current forbidden pad numbers
      var currentForbiddenPadNumberSet = Set <Int> ()
      for f in selectedPadZone.forbiddenPadNumbers {
        currentForbiddenPadNumberSet.insert (f.padNumber)
      }
      if currentForbiddenPadNumberSet.contains (proposedValue) {
        self.mAddZoneForbiddenPadNumberErrorTextField?.stringValue = "Duplicate Pad Number"
        self.mAddZoneForbiddenPadNumberOkButton?.isEnabled = false
      }else{
        self.mAddZoneForbiddenPadNumberErrorTextField?.stringValue = ""
        self.mAddZoneForbiddenPadNumberOkButton?.isEnabled = true
      }
    }else{
      self.mAddZoneForbiddenPadNumberErrorTextField?.stringValue = "Invalid Pad Number"
      self.mAddZoneForbiddenPadNumberOkButton?.isEnabled = false
    }
  }

}


//--- END OF USER ZONE 1
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS REGENERATED BY EASY BINDINGS, ONLY MODIFY IT WITHIN USER ZONES
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

extension PackageDocument {
  @objc func addZoneForbiddenPadNumberAction (_ sender : NSObject?) {
//--- START OF USER ZONE 2
    if self.mPackageZoneSelectionController.selectedArray.count == 1,
       let window = self.windowForSheet,
       let panel = self.mAddZoneForbiddenPadNumberDialog {
      let selectedPadZone = self.mPackageZoneSelectionController.selectedArray [0]
    //--- Current forbidden pad numbers
      var currentForbiddenPadNumberSet = Set <Int> ()
      for f in selectedPadZone.forbiddenPadNumbers {
        currentForbiddenPadNumberSet.insert (f.padNumber)
      }
    //--- Title
      let title = "Add a forbidden Pad Number to '\(selectedPadZone.zoneName)' Zone"
      self.mAddZoneForbiddenPadNumberTitle?.stringValue = title
    //--- Propose an initial value
      if let s = self.mAddZoneForbiddenPadNumberValueTextField?.stringValue, let initialValue = Int (s), initialValue > 0 {
        var proposedValue = initialValue
        while currentForbiddenPadNumberSet.contains (proposedValue) {
          proposedValue += 1
        }
        self.mAddZoneForbiddenPadNumberValueTextField?.integerValue = proposedValue
      }else{
        self.mAddZoneForbiddenPadNumberValueTextField?.integerValue = 1
      }
      self.mAddZoneForbiddenPadNumberErrorTextField?.stringValue = ""
      self.mAddZoneForbiddenPadNumberOkButton?.isEnabled = true
    //--- Configure Pad Number TextField
      self.mAddZoneForbiddenPadNumberValueTextField?.isContinuous = true
      self.mAddZoneForbiddenPadNumberValueTextField?.delegate = self
    //--- Dialog
      window.beginSheet (panel) { (_ inResponse : NSApplication.ModalResponse) in
        if inResponse == .stop, let newPadNumber = self.mAddZoneForbiddenPadNumberValueTextField?.integerValue {
          let fpn = ForbiddenPadNumber (self.ebUndoManager)
          fpn.padNumber = newPadNumber
          selectedPadZone.forbiddenPadNumbers.append (fpn)
        }
      }
    }
//--- END OF USER ZONE 2
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
